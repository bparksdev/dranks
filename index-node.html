<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/fontawesome.min.css">
        <link rel="stylesheet" href="index.css">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.min.js"></script>
        <script src="https://unpkg.com/vee-validate@2.0.0-rc.18/dist/vee-validate.js"></script>
        <script src="https://unpkg.com/axios@0.25.0/dist/axios.min.js"></script>
    </head>
    <body>
        <div id="app">
            <div class="header">
                <h1>Dranks A Lot! <img src="icon.png" style="width:40px" /></h1>
            </div>
            <div class="container-fluid">
                <h4>Search <button class="btn btn-small btn-primary btn-clear" id="btnClear">Clear</button></h4>
                <!-- <form id="searchForm" class="mb-3"> -->
                        
                <form @submit.prevent="getResults" class="mb-3">
                    <input type="text" v-model="byName" name="byName" class="form-control half-box" placeholder="By Name" />
                    <input type="text" v-model="byIngredient" name="byIngredient" class="form-control half-box" placeholder="By Ingredient" />
                    <button type="submit" class="btn btn-small btn-primary">Search</button>
                </form>
                        
                        
                            
                                <div v-for="drink in drinkResults" class='col-2 card mb-3' @click="getDetails(drink.idDrink)">
                                    <div class='card-header detail-link'>{{drink.strDrink}}</div>
                                    <div class='card-body'>
                                        <img :src="drink.strDrinkThumb" style="width:100%" />
                                    </div>
                                </div>
                           
                        


                <div class="card" id="card-details" style="display:none">
                    <div class="card-header">
                        <h3>Drink: <span id="drinkName"></span></h3>
                    </div>
                    <div class="card-body text-center">
                        <p><label>Suggested Glass:</label> <span id="glass"></span> </p>
                        <p id=""><label>Ingredients:</label><br /><span id="ingredients"></span></p>
                        <p id="instructions"></p>
                        <img id="picture" style="width:50%" class="text-center" />
                    </div>
                </div>
            </div>   
        </div>     
        <footer>
            &#169;2023 SkrapHeap Development
        </footer>    
    </body>
</html>

<script type="text/javascript">
new Vue({
    el: "#app",
    data () {
        return {
            byName: "",
            byIngredient: "",
            drinkResults: []
        }
    },    
    methods:{
        getResults() {
            const uri = this.byName.length ? `https://www.thecocktaildb.com/api/json/v1/1/search.php?s=${this.byName}` : `https://www.thecocktaildb.com/api/json/v1/1/filter.php?i=${this.byIngredient}`;
            axios.get(uri)
                .then(response => {
                    // let data = response.data;

                    // let resultHTML = "<div class='row'>";
                    // for(let x=0; x<data.drinks.length; x++) {
                    //     resultHTML += `<div class='col-sm-2'><div class='card mb-3' id=${data.drinks[x].idDrink} @click="getDetails('${data.drinks[x].idDrink}')"><div class='card-header detail-link'>${data.drinks[x].strDrink}</div>`;
                    //     resultHTML += `<div class='card-body'><img src=${data.drinks[x].strDrinkThumb} style="width:100%" /></div></div></div>` 
                    // }
                    // resultHTML += "</div>"
                    this.drinkResults = response.data.drinks
                    //console.log(response.data.drinks)

                    //console.log(drinkResults)

                    //document.getElementById("results").innerHTML = resultHTML;
                })
                .catch(error => {
                    console.log(error);
                });
        },
        getDetails: function(drinkID) {
            document.getElementById("results").style.display = 'none';

            axios.get(`https://www.thecocktaildb.com/api/json/v1/1/lookup.php?i=${drinkID}`)
            .then(response => {
                let data = response.data;

                document.getElementById("drinkName").innerHTML = data.drinks[0].strDrink;
                document.getElementById("instructions").innerHTML = data.drinks[0].strInstructions;
                //document.getElementById("picture").prop("src", data.drinks[0].strDrinkThumb)
                document.getElementById("glass").innerHTML = data.drinks[0].strGlass;
                var ingArray = [];
                for(i=1; i<15; i++) {
                    ing = "strIngredient" + i;
                    meas = "strMeasure" + i;
                    if(data.drinks[0][ing]) {
                        if(data.drinks[0][meas] != null) {
                            ingArray.push(data.drinks[0][meas] + " " + data.drinks[0][ing] + " <br /> ")

                        } else {
                            ingArray.push( data.drinks[0][ing] + " &middot; ")
                        }
                    }
                }
                console.log(ingArray)
                document.getElementById("ingredients").innerHTML = ingArray
                document.getElementById("card-details").style.display = 'block';
            })
            .catch(error => {
                console.log(error);
            });
        }
    }
});
</script>
